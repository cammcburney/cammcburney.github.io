---
layout: post
author: Cameron McBurney
tags: [pippop]
---

# PIPPOP
## 3D MULTIPLAYER SHOOTER
### C++ FOCUSED

![image](./images/COVER_PipPop.png)

*PipPop is a multiplayer first person shooter inspired by arena shooters*

### Features:  

***Chance Is Everything*** 

Classic turn based combat giving you time to plan your next strike, follow button sequences to deal extra damage or defend and stack multipliers.

<div style="max-height: 400px; overflow-y: auto; background: #1e1e1e; color: #dcdcdc; padding: 1em; border-radius: 8px;">
<pre><code class="language-cpp">
// ABaseGun.cpp
void ABaseGun::FireGun_Implementation()
{   
    if (!Ammo || !Magazines || !CanFire()) return;
    SpawnMuzzleFlash();
    AController* OwnerController = GetOwnerController();
    if (OwnerController == nullptr) return;
    FVector Location;
    FRotator Rotation;
    OwnerController->GetPlayerViewPoint(Location, Rotation);
    ServerBulletLineTrace(OwnerController, Location, Rotation);
    LastFireTime = GetWorld()->GetTimeSeconds();
    Ammo--;
    UE_LOG(LogTemp, Warning, TEXT("Ammo: %s"), *FString::Printf(TEXT("%d"), Ammo));
}

void ABaseGun::ServerBulletLineTrace_Implementation(AController* OwnerController, FVector Location, FRotator Rotation)
{
    FHitResult Hit;
    for (int32 i = 0; i < BulletsFiredPerShot; i++)
    {
        FBulletTrajectory Bullet = CalculateBulletTrajectory(Location, Rotation);
        if (GetWorld()->LineTraceSingleByChannel(Hit, Location, Bullet.End, ECollisionChannel::ECC_GameTraceChannel1))
        {
            SpawnBulletImpact(Hit, Bullet);
            DamageActors(OwnerController, Hit, Bullet);
        }
    }
}

void ABaseGun::DamageActors_Implementation(AController* OwnerController, FHitResult Hit, FBulletTrajectory Bullet)
{   
    if (HasAuthority())
    {
        AActor* DamagedActor = Hit.GetActor();
        if (DamagedActor && HasAuthority())
        {   
            float DamageReduction = MaxRange - Hit.Distance;
            if (DamageReduction < 0)
            {
                Damage = Damage - DamageReduction;
            }
            FPointDamageEvent DamageEvent(Damage, Hit, Bullet.ShotDirection, nullptr);
            AFirstPersonCharacter* Character = Cast<AFirstPersonCharacter>(DamagedActor);
            UE_LOG(LogTemp, Warning, TEXT("Damage Calculation Debug"));
            UE_LOG(LogTemp, Warning, TEXT("Hit Actor: %s"), *DamagedActor->GetName());
            UE_LOG(LogTemp, Warning, TEXT("Base Damage: %.2f"), Damage);
            UE_LOG(LogTemp, Warning, TEXT("Max Range: %.2f"), MaxRange);
            UE_LOG(LogTemp, Warning, TEXT("Hit Distance: %.2f"), Hit.Distance);
            if (Character)
            {   
                Character->TakeDamage(Damage, DamageEvent, OwnerController, this);
            }
        }
    }
}

FBulletTrajectory ABaseGun::CalculateBulletTrajectory(FVector Location, FRotator Rotation)
{
    FRotator SpreadRotation = Rotation;
    SpreadRotation.Pitch += FMath::RandRange(-SpreadAngles.DownAngle, SpreadAngles.UpAngle); 
    SpreadRotation.Yaw += FMath::RandRange(-SpreadAngles.LeftAngle, SpreadAngles.RightAngle);    
    FVector SpreadVector = SpreadRotation.Vector();

    FVector End = Location + SpreadVector* MaxRange; 
    FVector ShotDirection = -SpreadVector;
    return FBulletTrajectory{ ShotDirection, End };
}

AController* ABaseGun::GetOwnerController()
{
    // ...
}
</code></pre>
</div>


Notifies are used on the animation track to trigger a window for player input.

- If no input is recieved the attack misses and does no damage.
- If the input is recieved in the timeframe damage is dealt.
- If it is inputted within 10% of the midpoint of the timer it deals additional bonus damage.

***Source Code***: https://github.com/cammcburney/pippop_backup

***Future planned features***

On screen keyboard for controller players and to reflect player keyboard inputs
Parameterised final string length for reuse.
Add a resuable function for creating and setting the dynamic material instances.

